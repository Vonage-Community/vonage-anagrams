<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body {
            max-width: 100%;
        }

        .material-symbols-outlined {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;  /* Preferred icon size */
            display: inline-block;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;

            /* Support for all WebKit browsers. */
            -webkit-font-smoothing: antialiased;
            /* Support for Safari and Chrome. */
            text-rendering: optimizeLegibility;

            /* Support for Firefox. */
            -moz-osx-font-smoothing: grayscale;

            /* Support for IE. */
            font-feature-settings: 'liga';
        }
    </style>
</head>

<body>
    <h1>Anagrams Management</h1>

    <form method="POST" encoding="application/x-www-form-urlencoded" action="/admin/clear_anagram">
        <input type="submit" value="Clear Current">
    </form>
    <h2>Loaded Anagrams</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Current?</th>
                <th>Used?</th>
                <th>Actions</th>
                <th>Anagram</th>
                <th>Solution</th>
            </tr>
        <thead>
        {% for anagram in anagrams %}
        <tr>
            <td>
                {% if anagram.current %}
                    <span class="material-symbols-outlined">done_outline</span>
                {% else %}
                    <span class="material-symbols-outlined">cancel</span>
                {% endif %}
            </td>
            <td>
                {% if anagram.used %}
                    <span class="material-symbols-outlined">done_outline</span>
                {% else %}
                    <span class="material-symbols-outlined">cancel</span>
                {% endif %}
            </td>
            <td>
                <a href="/admin/setCurrent?id={{anagram.id}}">
                    <span class="material-symbols-outlined">add_box</span>
                </a>
                |
                <a href="/admin/delete?id={{anagram.id}}">
                    <span class="material-symbols-outlined">delete</span></td>
                </a>
            <td>{{ anagram.anagram }}</td>
            <td>{{ anagram.solution }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Add New Anagram</h2>
    <form method="POST" encoding="application/x-www-form-urlencoded">
        <label>Anagram:</label> <input name="anagram" type="text" style="width: 100%"><br />
        <label>Solution:</label> <input name="solution" type="text" style="width: 100%"><br />
        <input type="submit" value="Save Anagram">
    </form>

    <h1>Numbers Management</h1>

    <h2>Registered Numbers</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Number</th>
                <th>Notify?</th>
                <th>Actions</th>
            </tr>
        <thead>
        {% for number in mobileNumbers %}
        <tr>
            <td>{{ number.mobile_number}}
            <td>
                {% if number.notify %}
                    <span class="material-symbols-outlined">done_outline</span>
                {% else %}
                    <span class="material-symbols-outlined">cancel</span>
                {% endif %}
            </td>
            <td>
                <a href="/admin/delete_number?id={{number.id}}">
                    <span class="material-symbols-outlined">delete</span></td>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
    <form method="post" action="/admin/notify">
        <input type="submit" value="Notify of Anagram Change">
    </form>

    <h1>Vonage App Management</h1>

    <h2>Application Setup</h2>
    {% if application %}
        <strong>Currently configured application:</strong> {{ application.name }} ({{application.id}})

        <h2>Callback Management</h2>
        <form method="POST" encoding="application/x-www-form-urlencoded" action="/admin/admin_update_callbacks">
            <div>
                <strong>Current Message Inbound: </strong> {{ application.capabilities.messages.webhooks.inbound_url.address }}</br>
                <strong>Current Message Status: </strong> {{ application.capabilities.messages.webhooks.status_url.address }}</br>
            </div>
            <input type="submit" value="Update callbacks to Anagram Application">
        </form>

        <h2>Messages API Number Config</h2>
        {% if fromNumber %}
            <strong>Currently configured number:</strong> {{ fromNumber }}
        {% else %}
            <form method="POST" encoding="application/x-www-form-urlencoded" action="/admin/admin_assign_number">
                <strong>Please select a number to assign to this application:</strong>

                {% set numbers = [] %}
                {% if applicationNumbers %}
                    {% set numbers = applicationNumbers %}
                {% else %}
                    {% set numbers = availableNumbers %}
                {% endif %}

                <select name="fromNumber">
                    {% for number in numbers %}
                    <option value="{{number.msisdn}}">
                        {{ number.msisdn }}
                        {% if number.app_id %}
                            {% if number.app_id != application.id %}
                            (Number is assigned to {{ number.app_id }})
                            {% endif %}
                        {% endif %}
                    </option>
                    {% endfor %}
                </select>
                <input type="submit" value="Assign Number">
            </form>
        {% endif %}
    {% else %}
        <form method="POST" encoding="application/x-www-form-urlencoded" action="/admin/admin_set_application">
            <strong>Please select an application to use:</strong>
            <select name="application">
                {% for applicationData in applications %}
                <option value="{{applicationData.id}}">{{ applicationData.name }}</option>
                {% endfor %}
            </select>
            <strong>Private Key:</strong>
            <textarea name="private_key" required></textarea>
            <input type="submit" value="Assign Application">
        </form>
        <form method="POST" encoding="application/x-www-form-urlencoded" action="/admin/admin_create_application">
            <input type="submit" value="Create New Application">
        </form>
    {% endif %}
</body>
</html>